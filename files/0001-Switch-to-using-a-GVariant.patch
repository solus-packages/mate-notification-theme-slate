From 995a878255d44f0b5ed8f952525d34cd252bd11d Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@stroblindustries.com>
Date: Mon, 29 Apr 2019 19:33:52 +0300
Subject: [PATCH 1/1] Switch to using a GVariant.

---
 src/engine-api.h          |  2 +-
 src/engine.c              |  2 +-
 src/notification-window.c | 16 ++++++----------
 src/notification-window.h |  2 +-
 4 files changed, 9 insertions(+), 13 deletions(-)

diff --git a/src/engine-api.h b/src/engine-api.h
index 691caf7..dc04472 100644
--- a/src/engine-api.h
+++ b/src/engine-api.h
@@ -51,7 +51,7 @@ void hide_notification(GtkWindow *notif_window);
 /**
  * Update notification from the given hints mapping
  */
-void set_notification_hints(GtkWindow *notif_window, GHashTable *hints);
+void set_notification_hints(GtkWindow *notif_window, GVariant *hints);
 
 /**
  * Set the textual content for the notification
diff --git a/src/engine.c b/src/engine.c
index b56dc4e..32fcb90 100644
--- a/src/engine.c
+++ b/src/engine.c
@@ -326,7 +326,7 @@ __slate_public__ void clear_notification_actions(GtkWindow *notif_window)
         slate_notification_window_clear_actions(window);
 }
 
-__slate_public__ void set_notification_hints(GtkWindow *notif_window, GHashTable *hints)
+__slate_public__ void set_notification_hints(GtkWindow *notif_window, GVariant *hints)
 {
         if (!notif_window) {
                 return;
diff --git a/src/notification-window.c b/src/notification-window.c
index bb09192..345517a 100644
--- a/src/notification-window.c
+++ b/src/notification-window.c
@@ -296,18 +296,14 @@ void slate_notification_window_clear_actions(SlateNotificationWindow *self)
  * in future mate-notification-daemon will broadcast action-icons as a
  * capability.
  */
-void slate_notification_window_set_hints(SlateNotificationWindow *self, GHashTable *hints)
+void slate_notification_window_set_hints(SlateNotificationWindow *self, GVariant *hints)
 {
-    if (!hints && g_hash_table_size(hints) != 0) {
-        GValue *hash = NULL;
+    GVariant *actions_icons = NULL;
 
-        hash = g_hash_table_lookup(hints, "action-icons");
-    
-        if (!hash || !G_VALUE_HOLDS_BOOLEAN(hash)) {
-            return;
-        }
-    
-        self->action_icons = g_value_get_boolean(hash);
+    g_variant_lookup(hints, "action-icons", "v", &actions_icons);
+
+    if (actions_icons != NULL && g_variant_get_type(actions_icons) == G_VARIANT_TYPE_BOOLEAN) {
+        self->action_icons = g_variant_get_boolean(actions_icons);
     }
 }
 
diff --git a/src/notification-window.h b/src/notification-window.h
index 57a1962..46549a1 100644
--- a/src/notification-window.h
+++ b/src/notification-window.h
@@ -39,7 +39,7 @@ void slate_notification_window_add_action(SlateNotificationWindow *window, const
 
 void slate_notification_window_clear_actions(SlateNotificationWindow *window);
 
-void slate_notification_window_set_hints(SlateNotificationWindow *window, GHashTable *hints);
+void slate_notification_window_set_hints(SlateNotificationWindow *window, GVariant *hints);
 
 /*
  * Editor modelines  -  https://www.wireshark.org/tools/modelines.html
-- 
2.21.0

